<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mode Cr√©ation - Champs Cach√©s</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test-section { background: #f9f9f9; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .hidden { display: none; }
        .success { color: #059669; font-weight: bold; }
        .error { color: #dc2626; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üß™ Test Mode Cr√©ation - Champs B√©n√©ficiaires Cach√©s</h1>
    
    <div class="test-section">
        <h2>Simulation du mode cr√©ation (champs cach√©s)</h2>
        <p>Cette page simule le formulaire de cr√©ation o√π les champs b√©n√©ficiaires sont cach√©s.</p>
        
        <!-- Champs hidden comme en mode cr√©ation -->
        <input type="hidden" name="beneficiaires_hommes" value="0">
        <input type="hidden" name="beneficiaires_femmes" value="0">
        <input type="hidden" name="beneficiaires_total" value="0">
        
        <div id="test-results">
            <h3>R√©sultats des tests:</h3>
            <div id="js-test-result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>Simulation du mode √©dition (champs visibles)</h2>
        <p>Cette section simule le formulaire d'√©dition avec les champs visibles.</p>
        
        <div>
            <label for="beneficiaires_hommes_edit">B√©n√©ficiaires hommes:</label>
            <input type="number" id="beneficiaires_hommes" name="beneficiaires_hommes_edit" min="0" value="10">
        </div>
        <br>
        <div>
            <label for="beneficiaires_femmes_edit">B√©n√©ficiaires femmes:</label>
            <input type="number" id="beneficiaires_femmes" name="beneficiaires_femmes_edit" min="0" value="15">
        </div>
        <br>
        <input type="hidden" id="beneficiaires_total" name="beneficiaires_total_edit" value="25">
        
        <div>
            <strong>Total b√©n√©ficiaires:</strong>
            <div id="beneficiaires-total-display" style="font-size: 18px; color: #0369a1; font-weight: bold;">25</div>
        </div>
    </div>

    <script>
        // Code identique √† celui du formulaire Laravel
        console.log('üîç Test du JavaScript en mode cr√©ation/√©dition...');
        
        const beneficiairesHommesInput = document.getElementById('beneficiaires_hommes');
        const beneficiairesFemmesInput = document.getElementById('beneficiaires_femmes');
        const beneficiairesTotalInput = document.getElementById('beneficiaires_total');
        const beneficiairesTotalDisplay = document.getElementById('beneficiaires-total-display');

        function calculateBeneficiairesTotal() {
            const hommes = parseInt(beneficiairesHommesInput.value) || 0;
            const femmes = parseInt(beneficiairesFemmesInput.value) || 0;
            const total = hommes + femmes;
            
            beneficiairesTotalInput.value = total;
            
            if (beneficiairesTotalDisplay) {
                beneficiairesTotalDisplay.textContent = total;
            }
            
            console.log('Calcul effectu√©:', { hommes, femmes, total });
        }

        // Test du comportement avec et sans √©l√©ments
        let testResults = [];

        // Test 1: V√©rifier que les √©l√©ments sont d√©tect√©s correctement
        if (beneficiairesHommesInput && beneficiairesFemmesInput) {
            testResults.push('‚úÖ Mode √©dition: √âl√©ments d√©tect√©s, calcul activ√©');
            
            // Event listeners
            beneficiairesHommesInput.addEventListener('input', calculateBeneficiairesTotal);
            beneficiairesFemmesInput.addEventListener('input', calculateBeneficiairesTotal);
            
            // Calcul initial
            calculateBeneficiairesTotal();
        } else {
            testResults.push('‚úÖ Mode cr√©ation: √âl√©ments non d√©tect√©s, pas d\'erreur JavaScript');
        }

        // Test 2: V√©rifier les champs hidden
        const hiddenFields = document.querySelectorAll('input[type="hidden"][name*="beneficiaires"]');
        if (hiddenFields.length > 0) {
            testResults.push(`‚úÖ Champs hidden d√©tect√©s: ${hiddenFields.length} champ(s)`);
        }

        // Test 3: V√©rifier l'absence d'erreurs
        window.onerror = function(msg, url, line) {
            testResults.push(`‚ùå Erreur JavaScript: ${msg} (ligne ${line})`);
            updateResults();
        };

        function updateResults() {
            const resultDiv = document.getElementById('js-test-result');
            resultDiv.innerHTML = testResults.map(result => `<div>${result}</div>`).join('');
        }

        // Afficher les r√©sultats apr√®s un court d√©lai
        setTimeout(() => {
            updateResults();
            console.log('Tests termin√©s:', testResults);
        }, 100);

        // Test automatique du calcul
        setTimeout(() => {
            if (beneficiairesHommesInput && beneficiairesFemmesInput) {
                beneficiairesHommesInput.value = 20;
                beneficiairesFemmesInput.value = 30;
                calculateBeneficiairesTotal();
                testResults.push('‚úÖ Test automatique du calcul: 20 + 30 = 50');
                updateResults();
            }
        }, 500);
    </script>
</body>
</html>
